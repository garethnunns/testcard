<html>
	<head>
		<title>Test Card</title>

		<style>
		html,body {
			margin: 0;
			padding: 0;
		}

		canvas {
			width: 100%;
		}
		</style>
	</head>

	<body>
		<canvas></canvas>

		<script type="text/javascript">
class Card {
	constructor(ctx, options = null) {
		this.ctx = ctx
		
		if(options == null)
			options = {
				width: 1920,
				height: 1080,
				fps: 24,
				colors: {
					bg: '#000000',
					fg: '#ffffff',
					accent: '#ffcc00'
				}
			}
		
		this.options = options
			
		this.options.margins = {
			h: options.width / 15,
			v: options.height / 10,
		}

		this.ctx.canvas.width  = options.width
		this.ctx.canvas.height = options.height

		this.render = this.render.bind(this)

		this._frame = 0

		// duration in frames
		this.duration = 2 * this.options.fps + 3

		this.render()
	}

	get frame() {
		return this._frame
	}

	set frame(frame) {
		if (frame >= this.duration) {
			this._frame = 0
			return
		}
		
		this._frame = frame
	}

	render() {
		const ctx = this.ctx

		ctx.save();
		ctx.fillStyle = this.options.colors.bg;
		ctx.fillRect(0,0,this.options.width,this.options.height);
		
		ctx.strokeStyle = this.options.colors.fg;
		ctx.fillStyle = this.options.colors.fg;
		ctx.lineCap = "round";
		ctx.font = "30px Arial";
		ctx.fillText("Frame: "+this.frame, this.options.margins.h, this.options.margins.v);


		// marks
		ctx.save();

		// line markers
		ctx.lineWidth = 2;
		ctx.strokeStyle = this.hexToRgba(this.options.colors.fg, 0.5)

		const markHeight = this.options.height / 10
		const markNum = this.duration - 1
		const markGap = Math.floor((this.options.width - 2 * this.options.margins.h) / markNum)

		const markLeft = Math.floor(this.options.width / 2 - ((this.options.fps + 0.5) * markGap))
		const markBottom = this.options.height - 2 * this.options.margins.v
		const markTop = markBottom - markHeight;

		for (var i=0; i < markNum; i++) {
			const left = markLeft + i * markGap
			ctx.beginPath();
			ctx.moveTo(left, markBottom - markHeight)
			ctx.lineTo(left, markBottom)
			ctx.stroke();
		}
		ctx.save();

		// triangles
		ctx.fillStyle = this.options.colors.accent;

		const triTop = markTop - this.options.height / 100
		const triBottom = markBottom + this.options.height / 100
		const triWidth = this.options.width / 20
		const triHeight = Math.min(this.options.height / 20,triWidth / 1.5)
		const triFontSize = triWidth/2

		var small = false;

		ctx.font = `${triFontSize}px Arial`
		ctx.textAlign = 'center'
		//ctx.fillText("Hello World", canvas.width/2, canvas.height/2);

		var offset = -1;

		const triNum = 4;

		for(var i = 0.5; i < (markNum - 1); i += (this.options.fps/triNum)) {
			const cent = markLeft + i * markGap
			const width = (1 - small * 0.5) * 0.5 * triWidth
			const height = (1 - small * 0.5) * triHeight

			// top triangles
			ctx.beginPath();
			ctx.moveTo(cent, triTop)
			ctx.lineTo(cent + width, triTop - height)
			ctx.lineTo(cent - width, triTop - height)
			ctx.closePath()
			ctx.fill()

			if(!small) ctx.fillText(offset * this.options.fps, cent, triTop - height - triWidth/10)

			// bottom triangles
			ctx.beginPath();
			ctx.moveTo(cent, triBottom)
			ctx.lineTo(cent + width, triBottom + height)
			ctx.lineTo(cent - width, triBottom + height)
			ctx.closePath()
			ctx.fill()

			if(!small) ctx.fillText(offset, cent, triBottom + height + triFontSize)

			small = !small
			offset += 1/triNum
		}

		ctx.save();

		// end of constants in image

		ctx.restore();

		// frame marker
		const markerLeft = markLeft + ((this.frame - 1) * markGap)

		if(this.frame != 0 && this.frame != this.duration-1)
			ctx.fillRect(markerLeft , markTop, markGap, markHeight)

		this.frame++;
		setTimeout(this.render, (1000/this.options.fps)*1)
		return ctx;
	}

	hexToRgb(hex) {
		const result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex)
		return result ? {
			r: parseInt(result[1], 16),
			g: parseInt(result[2], 16),
			b: parseInt(result[3], 16)
		} : null
	}

	hexToRgba(hex, a) {
		const rgb = this.hexToRgb(hex)
		return `rgba(${rgb.r},${rgb.g},${rgb.b},${a})`
	}
}

const ctx = document.querySelector('canvas').getContext('2d')

var testCard = new Card(ctx);
		</script>
	</body>
</html>